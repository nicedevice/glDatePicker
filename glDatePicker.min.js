/*!
 * glDatePicker v2.0
 * http://glad.github.com/glDatePicker/
 *
 * Copyright (c) 2013 Gautam Lad.  All rights reserved.
 * Released under the MIT license.
 *
 * Date: Tue Jan 1 2013
 */(function(){$.fn.glDatePicker=function(e){var t="glDatePicker",n=this.data(t);return n?e===!0?n:this:this.each(function(){return $(this).data(t,new glDatePicker(this,e))})};$.fn.glDatePicker.defaults={cssName:"default",zIndex:1e3,borderSize:1,calendarOffset:{x:0,y:1},showAlways:!1,hideOnClick:!0,allowMonthSelect:!0,allowYearSelect:!0,todayDate:new Date,selectedDate:null,prevArrow:"◄",nextArrow:"►",selectableDates:null,selectableDateRange:null,specialDates:null,selectableMonths:null,selectableYears:null,selectableDOW:null,monthNames:null,dowNames:null,dowOffset:0,onClick:function(e,t,n,r){e.val(n.toLocaleDateString())},onHover:function(e,t,n,r){},onShow:function(e){e.show()},onHide:function(e){e.hide()},firstDate:null,showDateInputInitial:!0};var glDatePicker=function(){function glDatePicker(e,t){var n=this;n.el=$(e);var r=n.el;n.options=$.extend(!0,{},$.fn.glDatePicker.defaults,t);var i=n.options;n.calendar=$($.find("[gldp-el="+r.attr("gldp-id")+" ]"));i.selectedDate=i.selectedDate||i.todayDate;i.firstDate=(new Date(i.firstDate||i.selectedDate))._first();(r.attr("gldp-id")||"").length||r.attr("gldp-id","gldp-"+Math.round(Math.random()*1e10));r.addClass("gldp-el").bind("click",function(e){n.show(e)}).bind("focus",function(e){n.show(e)});n.calendar.length&&!i.showAlways&&n.calendar.hide();$(document).bind("mouseup",function(e){var t=e.target,i=n.calendar;!r.is(t)&&!i.is(t)&&i.has(t).length===0&&i.is(":visible")&&n.hide()});n.render();i.showDateInputInitial&&i.onClick(r,$(this),i.selectedDate)}glDatePicker.prototype={show:function(){$.each($(".gldp-el").not(this.el),function(e,t){t.length&&t.options.onHide(t.calendar)});this.options.onShow(this.calendar)},hide:function(){this.options&&!this.options.showAlways&&this.options.onHide(this.calendar)},render:function(renderCalback){var self=this,el=self.el,options=self.options,calendar=self.calendar,coreClass=" core border ",cssName="gldp-"+options.cssName,todayVal=options.todayDate._val(),todayTime=todayVal.time,maxRow=6,maxCol=7,borderSize=options.borderSize+"px",getSelectableList=function(e,t,n){var r=[];for(var i=e;i<=t;i++)r.push(i);if(n){var s=[];$.each(n,function(n,r){r>=e&&r<=t&&s._indexOf(r)<0&&s.push(r)});r=s.length?s:r}r.sort();return r},selectableMonths=getSelectableList(0,11,options.selectableMonths),selectableYears=getSelectableList(todayVal.year-5,todayVal.year+5,options.selectableYears),selectableDOW=getSelectableList(0,6,options.selectableDOW),dowNames=options.dowNames||["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],monthNames=options.monthNames||["January","February","March","April","May","June","July","August","September","October","November","December"],containerWidth=el.outerWidth(),containerHeight=containerWidth,getCellSize=function(e,t){return e/t+options.borderSize/t*(t-1)},cellWidth=getCellSize(containerWidth,maxCol),cellHeight=getCellSize(containerHeight,maxRow+2);if(!calendar.length){self.calendar=calendar=$("<div/>").attr("gldp-el",el.attr("gldp-id")).data("is",!0).css({display:options.showAlways?undefined:"none",zIndex:options.zIndex,width:cellWidth*maxCol+"px"});$("body").append(calendar)}else if(!eval(calendar.data("is"))){containerWidth=calendar.outerWidth();containerHeight=calendar.outerHeight();cellWidth=getCellSize(containerWidth,maxCol);cellHeight=getCellSize(containerHeight,maxRow+2)}el.is(":visible")||calendar.hide();calendar.removeClass().addClass(cssName).children().remove();var onResize=function(){var e=el.offset();calendar.css({top:e.top+el.outerHeight()+options.calendarOffset.y+"px",left:e.left+options.calendarOffset.x+"px"})};$(window).resize(onResize);onResize();var cellCSS={width:cellWidth+"px",height:cellHeight+"px",lineHeight:cellHeight+"px"},setFirstDate=function(e){if(e){options.firstDate=e;self.render()}},getFirstDate=function(e){var t=new Date(options.firstDate);e=e||0;for(;;){t.setMonth(t.getMonth()+e);t.setDate(Math.min(1,t._max()));if(e==0)break;var n=t._val(),r=n.month,i=n.year;if(selectableMonths._indexOf(r)!=-1){if(selectableYears._indexOf(i)!=-1)break;if(i<selectableYears[0]||i>selectableYears[selectableYears.length-1])return null}}return t},prevFirstDate=getFirstDate(-1),nextFirstDate=getFirstDate(1),firstDate=options.firstDate=getFirstDate(),firstDateVal=firstDate._val(),firstDateMonth=firstDateVal.month,firstDateYear=firstDateVal.year,startDate=new Date(firstDate),dowOffset=Math.abs(Math.min(6,Math.max(0,options.dowOffset))),startOffset=startDate.getDay()-dowOffset;startOffset=startOffset<1?-7-startOffset:-startOffset;dowNames=dowNames.concat(dowNames).slice(dowOffset,dowOffset+7);startDate._add(startOffset);var showPrev=prevFirstDate,showNext=nextFirstDate,monyearClass=coreClass+"monyear ",prevCell=$("<div/>").addClass(monyearClass).css($.extend({},cellCSS,{borderWidth:borderSize+" 0 0 "+borderSize})).append($("<a/>").addClass("prev-arrow"+(showPrev?"":"-off")).html(options.prevArrow)).mousedown(function(){return!1}).click(function(e){if(options.prevArrow!=""&&showPrev){e.stopPropagation();setFirstDate(prevFirstDate)}}),titleCellCount=maxCol-2,titleWidth=cellWidth*titleCellCount-titleCellCount*options.borderSize+options.borderSize,titleCell=$("<div/>").addClass(monyearClass+"title").css($.extend({},cellCSS,{width:titleWidth+"px",borderTopWidth:borderSize,marginLeft:"-"+borderSize})),nextCell=$("<div/>").addClass(monyearClass).css($.extend({},cellCSS,{marginLeft:"-"+borderSize,borderWidth:borderSize+" "+borderSize+" 0 0"})).append($("<a/>").addClass("next-arrow"+(showNext?"":"-off")).html(options.nextArrow)).mousedown(function(){return!1}).click(function(e){if(options.nextArrow!=""&&showNext){e.stopPropagation();setFirstDate(nextFirstDate)}});calendar.append(prevCell).append(titleCell).append(nextCell);for(var row=0,cellIndex=0;row<maxRow+1;row++)for(var col=0;col<maxCol;col++,cellIndex++){var cellDate=new Date(startDate),cellClass="day",cellZIndex=options.zIndex+cellIndex,cell=$("<div/>");if(!row){cellClass="dow";cell.html(dowNames[col]);cellDate=null}else{cellDate._add(col+(row-1)*maxCol);var cellDateVal=cellDate._val(),cellDateTime=cellDateVal.time,specialData=null,isSelectable=!0,getRepeatDate=function(e,t){e.repeatYear===!0&&t.setYear(cellDateVal.year);e.repeatMonth===!0&&t.setMonth(cellDateVal.month);return t._val()};cell.html(cellDateVal.date);if(options.selectableDateRange){isSelectable=!1;$.each(options.selectableDateRange,function(e,t){var n=t.from,r=t.to||null;r=r||new Date(t.from.getFullYear(),t.from.getMonth(),t.from._max());n=getRepeatDate(t,n);r=getRepeatDate(t,r);if(cellDateTime>=n.time&&cellDateTime<=r.time){isSelectable=!0;return!0}})}if(options.selectableDates){if(options.selectableDateRange&&!isSelectable||isSelectable&&!options.selectableDateRange)isSelectable=!1;$.each(options.selectableDates,function(e,t){var n=getRepeatDate(t,t.date);if(n.time==cellDateTime)return isSelectable=!0})}if(!isSelectable||selectableYears._indexOf(cellDateVal.year)<0||selectableMonths._indexOf(cellDateVal.month)<0||selectableDOW._indexOf(cellDateVal.day)<0)cellClass="noday";else{cellClass=["sun","mon","tue","wed","thu","fri","sat"][cellDateVal.day];firstDateMonth!=cellDateVal.month&&(cellClass+=" outday");if(todayTime==cellDateTime){cellClass="today";cellZIndex+=50}if(options.selectedDate._time()==cellDateTime){cellClass="selected";cellZIndex+=51}options.specialDates&&$.each(options.specialDates,function(e,t){var n=getRepeatDate(t,t.date);if(n.time==cellDateTime){cellClass=t.cssClass||"special";cellZIndex+=52;specialData=t.data}});cell.mousedown(function(){return!1}).hover(function(e){e.stopPropagation();var t=$(this).data("data");options.onHover(el,cell,t.date,t.data)}).click(function(e){e.stopPropagation();var t=$(this).data("data");options.selectedDate=options.firstDate=t.date;self.render(function(){!options.showAlways&&options.hideOnClick&&self.hide()});options.onClick(el,$(this),t.date,t.data)})}}$.extend(cellCSS,{borderTopWidth:borderSize,borderBottomWidth:borderSize,borderLeftWidth:row>0||!row&&!col?borderSize:0,borderRightWidth:row>0||!row&&col==6?borderSize:0,marginLeft:col>0?"-"+borderSize:0,marginTop:row>0?"-"+borderSize:0,zIndex:cellZIndex});cell.data("data",{date:cellDate,data:specialData}).addClass(coreClass+cellClass).css(cellCSS);calendar.append(cell)}var toggleYearMonthSelect=function(e){var t="inline-block",n="none";if(options.allowMonthSelect){monthText.css({display:e?t:n});monthSelect.css({display:e?n:t})}if(options.allowYearSelect){yearText.css({display:e?n:t});yearSelect.css({display:e?t:n})}},onYearMonthSelect=function(){options.firstDate=new Date(yearSelect.val(),monthSelect.val(),1);self.render()},monthSelect=$("<select/>").hide().change(onYearMonthSelect),yearSelect=$("<select/>").hide().change(onYearMonthSelect),monthText=$("<span/>").html(monthNames[firstDateMonth]).mousedown(function(){return!1}).click(function(e){e.stopPropagation();toggleYearMonthSelect(!1)}),yearText=$("<span/>").html(firstDateYear).mousedown(function(){return!1}).click(function(e){e.stopPropagation();toggleYearMonthSelect(!0)});$.each(monthNames,function(e,t){if(options.allowMonthSelect&&selectableMonths._indexOf(e)!=-1){var n=$("<option/>").html(t).attr("value",e);e==firstDateMonth&&n.attr("selected","selected");monthSelect.append(n)}});$.each(selectableYears,function(e,t){if(options.allowYearSelect){var n=$("<option/>").html(t).attr("value",t);t==firstDateYear&&n.attr("selected","selected");yearSelect.append(n)}});var titleYearMonth=$("<div/>").append(monthText).append(monthSelect).append(yearText).append(yearSelect);titleCell.children().remove();titleCell.append(titleYearMonth);renderCalback=renderCalback||function(){};renderCalback()}};return glDatePicker}();(function(){Date.prototype._clear=function(){this.setHours(0);this.setMinutes(0);this.setSeconds(0);this.setMilliseconds(0);return this};Date.prototype._time=function(){return this._clear().getTime()};Date.prototype._max=function(){var e=(new Date(this.getYear(),1,29)).getMonth()==1?1:0,t=[31,28+e,31,30,31,30,31,31,30,31,30,31];return t[this.getMonth()]};Date.prototype._add=function(e){this.setDate(this.getDate()+e)};Date.prototype._first=function(){var e=new Date(this);e.setDate(1);return e};Date.prototype._val=function(){this._clear();return{year:this.getFullYear(),month:this.getMonth(),date:this.getDate(),time:this.getTime(),day:this.getDay()}};Array.prototype._indexOf=function(e){return $.inArray(e,this)}})()})();